{
  "openapi": "3.0.4",
  "info": {
    "title": "JackSite.YarpApi.Gateway",
    "version": "1.0"
  },
  "paths": {
    "/api/gateway-config/list/{type}": {
      "get": {
        "tags": [
          "JackSite.YarpApi.Gateway"
        ],
        "description": "获取网关配置",
        "operationId": "获取网关配置",
        "parameters": [
          {
            "name": "type",
            "in": "path",
            "required": true,
            "schema": {
              "type": "integer",
              "format": "int32"
            }
          }
        ],
        "responses": {
          "200": {
            "description": "OK",
            "content": {
              "application/json": {
                "schema": { }
              }
            }
          },
          "400": {
            "description": "Bad Request",
            "content": {
              "application/problem+json": {
                "schema": {
                  "$ref": "#/components/schemas/ProblemDetails"
                }
              }
            }
          }
        }
      }
    },
    "/api/gateway-config/route": {
      "post": {
        "tags": [
          "JackSite.YarpApi.Gateway"
        ],
        "description": "添加路由配置",
        "operationId": "添加路由配置",
        "requestBody": {
          "content": {
            "application/json": {
              "schema": {
                "$ref": "#/components/schemas/CreateRouteCommand"
              }
            }
          },
          "required": true
        },
        "responses": {
          "400": {
            "description": "Bad Request",
            "content": {
              "application/problem+json": {
                "schema": {
                  "$ref": "#/components/schemas/ProblemDetails"
                }
              }
            }
          }
        }
      },
      "put": {
        "tags": [
          "JackSite.YarpApi.Gateway"
        ],
        "description": "更新路由配置",
        "operationId": "更新路由配置",
        "requestBody": {
          "content": {
            "application/json": {
              "schema": {
                "$ref": "#/components/schemas/UpdateRouteCommand"
              }
            }
          },
          "required": true
        },
        "responses": {
          "400": {
            "description": "Bad Request",
            "content": {
              "application/problem+json": {
                "schema": {
                  "$ref": "#/components/schemas/ProblemDetails"
                }
              }
            }
          }
        }
      },
      "delete": {
        "tags": [
          "JackSite.YarpApi.Gateway"
        ],
        "description": "删除路由配置",
        "operationId": "删除路由配置",
        "requestBody": {
          "content": {
            "application/json": {
              "schema": {
                "$ref": "#/components/schemas/DeleteRouteCommand"
              }
            }
          },
          "required": true
        },
        "responses": {
          "400": {
            "description": "Bad Request",
            "content": {
              "application/problem+json": {
                "schema": {
                  "$ref": "#/components/schemas/ProblemDetails"
                }
              }
            }
          }
        }
      }
    },
    "/api/gateway-config/cluster": {
      "post": {
        "tags": [
          "JackSite.YarpApi.Gateway"
        ],
        "description": "添加集群配置",
        "operationId": "添加集群配置",
        "requestBody": {
          "content": {
            "application/json": {
              "schema": {
                "$ref": "#/components/schemas/CreateClusterCommand"
              }
            }
          },
          "required": true
        },
        "responses": {
          "400": {
            "description": "Bad Request",
            "content": {
              "application/problem+json": {
                "schema": {
                  "$ref": "#/components/schemas/ProblemDetails"
                }
              }
            }
          }
        }
      },
      "put": {
        "tags": [
          "JackSite.YarpApi.Gateway"
        ],
        "description": "更新集群配置",
        "operationId": "更新集群配置",
        "requestBody": {
          "content": {
            "application/json": {
              "schema": {
                "$ref": "#/components/schemas/UpdateClusterCommand"
              }
            }
          },
          "required": true
        },
        "responses": {
          "400": {
            "description": "Bad Request",
            "content": {
              "application/problem+json": {
                "schema": {
                  "$ref": "#/components/schemas/ProblemDetails"
                }
              }
            }
          }
        }
      },
      "delete": {
        "tags": [
          "JackSite.YarpApi.Gateway"
        ],
        "description": "删除集群配置",
        "operationId": "删除集群配置",
        "requestBody": {
          "content": {
            "application/json": {
              "schema": {
                "$ref": "#/components/schemas/DeleteClusterCommand"
              }
            }
          },
          "required": true
        },
        "responses": {
          "400": {
            "description": "Bad Request",
            "content": {
              "application/problem+json": {
                "schema": {
                  "$ref": "#/components/schemas/ProblemDetails"
                }
              }
            }
          }
        }
      }
    },
    "/api/gateway-config/reload/{type}": {
      "get": {
        "tags": [
          "JackSite.YarpApi.Gateway"
        ],
        "description": "重新加载配置",
        "operationId": "重新加载配置",
        "parameters": [
          {
            "name": "type",
            "in": "path",
            "required": true,
            "schema": {
              "type": "integer",
              "format": "int32"
            }
          }
        ],
        "responses": {
          "400": {
            "description": "Bad Request",
            "content": {
              "application/problem+json": {
                "schema": {
                  "$ref": "#/components/schemas/ProblemDetails"
                }
              }
            }
          }
        }
      }
    },
    "/api/gateway/access-records": {
      "post": {
        "tags": [
          "JackSite.YarpApi.Gateway"
        ],
        "operationId": "GetAccessRecords",
        "requestBody": {
          "content": {
            "application/json": {
              "schema": {
                "$ref": "#/components/schemas/GetGatewayRequestQuery"
              }
            }
          },
          "required": true
        },
        "responses": {
          "200": {
            "description": "OK"
          }
        }
      }
    }
  },
  "components": {
    "schemas": {
      "ActiveHealthCheckConfig": {
        "type": "object",
        "properties": {
          "enabled": {
            "type": "boolean",
            "nullable": true
          },
          "interval": {
            "type": "string",
            "format": "date-span",
            "nullable": true
          },
          "timeout": {
            "type": "string",
            "format": "date-span",
            "nullable": true
          },
          "policy": {
            "type": "string",
            "nullable": true
          },
          "path": {
            "type": "string",
            "nullable": true
          },
          "query": {
            "type": "string",
            "nullable": true
          }
        },
        "additionalProperties": false
      },
      "ClusterConfig": {
        "type": "object",
        "properties": {
          "clusterId": {
            "type": "string",
            "nullable": true
          },
          "loadBalancingPolicy": {
            "type": "string",
            "nullable": true
          },
          "sessionAffinity": {
            "$ref": "#/components/schemas/SessionAffinityConfig"
          },
          "healthCheck": {
            "$ref": "#/components/schemas/HealthCheckConfig"
          },
          "httpClient": {
            "$ref": "#/components/schemas/HttpClientConfig"
          },
          "httpRequest": {
            "$ref": "#/components/schemas/ForwarderRequestConfig"
          },
          "destinations": {
            "type": "object",
            "additionalProperties": {
              "$ref": "#/components/schemas/DestinationConfig"
            },
            "nullable": true
          },
          "metadata": {
            "type": "object",
            "additionalProperties": {
              "type": "string"
            },
            "nullable": true
          }
        },
        "additionalProperties": false
      },
      "CookieSecurePolicy": {
        "enum": [
          0,
          1,
          2
        ],
        "type": "integer",
        "format": "int32"
      },
      "CreateClusterCommand": {
        "type": "object",
        "properties": {
          "clusterId": {
            "type": "string",
            "nullable": true
          },
          "clusterConfig": {
            "$ref": "#/components/schemas/ClusterConfig"
          }
        },
        "additionalProperties": false
      },
      "CreateRouteCommand": {
        "type": "object",
        "properties": {
          "routeId": {
            "type": "string",
            "nullable": true
          },
          "routeConfig": {
            "$ref": "#/components/schemas/RouteConfig"
          }
        },
        "additionalProperties": false
      },
      "DeleteClusterCommand": {
        "type": "object",
        "properties": {
          "clusterId": {
            "type": "string",
            "nullable": true
          }
        },
        "additionalProperties": false
      },
      "DeleteRouteCommand": {
        "type": "object",
        "properties": {
          "routeId": {
            "type": "string",
            "nullable": true
          }
        },
        "additionalProperties": false
      },
      "DestinationConfig": {
        "type": "object",
        "properties": {
          "address": {
            "type": "string",
            "nullable": true
          },
          "health": {
            "type": "string",
            "nullable": true
          },
          "metadata": {
            "type": "object",
            "additionalProperties": {
              "type": "string"
            },
            "nullable": true
          },
          "host": {
            "type": "string",
            "nullable": true
          }
        },
        "additionalProperties": false
      },
      "ForwarderRequestConfig": {
        "type": "object",
        "properties": {
          "activityTimeout": {
            "type": "string",
            "format": "date-span",
            "nullable": true
          },
          "version": {
            "type": "string",
            "nullable": true
          },
          "versionPolicy": {
            "$ref": "#/components/schemas/HttpVersionPolicy"
          },
          "allowResponseBuffering": {
            "type": "boolean",
            "nullable": true
          }
        },
        "additionalProperties": false
      },
      "GetGatewayRequestQuery": {
        "type": "object",
        "properties": {
          "path": {
            "type": "string",
            "nullable": true
          },
          "method": {
            "type": "string",
            "nullable": true
          },
          "queryString": {
            "type": "string",
            "nullable": true
          },
          "requestBody": {
            "type": "string",
            "nullable": true
          },
          "requestHeaders": {
            "type": "string",
            "nullable": true
          },
          "responseHeaders": {
            "type": "string",
            "nullable": true
          },
          "responseBody": {
            "type": "string",
            "nullable": true
          },
          "statusCode": {
            "type": "integer",
            "format": "int32",
            "nullable": true
          },
          "errorMessage": {
            "type": "string",
            "nullable": true
          },
          "stackTrace": {
            "type": "string",
            "nullable": true
          },
          "clientIp": {
            "type": "string",
            "nullable": true
          },
          "userAgent": {
            "type": "string",
            "nullable": true
          },
          "executionTime": {
            "type": "integer",
            "format": "int64",
            "nullable": true
          },
          "targetService": {
            "type": "string",
            "nullable": true
          },
          "requestTimeRange": {
            "type": "array",
            "items": {
              "type": "string",
              "format": "date-time"
            },
            "nullable": true
          },
          "responseTimeRange": {
            "type": "array",
            "items": {
              "type": "string",
              "format": "date-time"
            },
            "nullable": true
          },
          "pageIndex": {
            "type": "integer",
            "format": "int32"
          },
          "pageSize": {
            "type": "integer",
            "format": "int32"
          }
        },
        "additionalProperties": false
      },
      "HeaderMatchMode": {
        "enum": [
          0,
          1,
          2,
          3,
          4,
          5
        ],
        "type": "integer",
        "format": "int32"
      },
      "HealthCheckConfig": {
        "type": "object",
        "properties": {
          "passive": {
            "$ref": "#/components/schemas/PassiveHealthCheckConfig"
          },
          "active": {
            "$ref": "#/components/schemas/ActiveHealthCheckConfig"
          },
          "availableDestinationsPolicy": {
            "type": "string",
            "nullable": true
          }
        },
        "additionalProperties": false
      },
      "HttpClientConfig": {
        "type": "object",
        "properties": {
          "sslProtocols": {
            "$ref": "#/components/schemas/SslProtocols"
          },
          "dangerousAcceptAnyServerCertificate": {
            "type": "boolean",
            "nullable": true
          },
          "maxConnectionsPerServer": {
            "type": "integer",
            "format": "int32",
            "nullable": true
          },
          "webProxy": {
            "$ref": "#/components/schemas/WebProxyConfig"
          },
          "enableMultipleHttp2Connections": {
            "type": "boolean",
            "nullable": true
          },
          "requestHeaderEncoding": {
            "type": "string",
            "nullable": true
          },
          "responseHeaderEncoding": {
            "type": "string",
            "nullable": true
          }
        },
        "additionalProperties": false
      },
      "HttpVersionPolicy": {
        "enum": [
          0,
          1,
          2
        ],
        "type": "integer",
        "format": "int32"
      },
      "PassiveHealthCheckConfig": {
        "type": "object",
        "properties": {
          "enabled": {
            "type": "boolean",
            "nullable": true
          },
          "policy": {
            "type": "string",
            "nullable": true
          },
          "reactivationPeriod": {
            "type": "string",
            "format": "date-span",
            "nullable": true
          }
        },
        "additionalProperties": false
      },
      "ProblemDetails": {
        "type": "object",
        "properties": {
          "type": {
            "type": "string",
            "nullable": true
          },
          "title": {
            "type": "string",
            "nullable": true
          },
          "status": {
            "type": "integer",
            "format": "int32",
            "nullable": true
          },
          "detail": {
            "type": "string",
            "nullable": true
          },
          "instance": {
            "type": "string",
            "nullable": true
          }
        },
        "additionalProperties": { }
      },
      "QueryParameterMatchMode": {
        "enum": [
          0,
          1,
          2,
          3,
          4
        ],
        "type": "integer",
        "format": "int32"
      },
      "RouteConfig": {
        "type": "object",
        "properties": {
          "routeId": {
            "type": "string",
            "nullable": true
          },
          "match": {
            "$ref": "#/components/schemas/RouteMatch"
          },
          "order": {
            "type": "integer",
            "format": "int32",
            "nullable": true
          },
          "clusterId": {
            "type": "string",
            "nullable": true
          },
          "authorizationPolicy": {
            "type": "string",
            "nullable": true
          },
          "rateLimiterPolicy": {
            "type": "string",
            "nullable": true
          },
          "outputCachePolicy": {
            "type": "string",
            "nullable": true
          },
          "timeoutPolicy": {
            "type": "string",
            "nullable": true
          },
          "timeout": {
            "type": "string",
            "format": "date-span",
            "nullable": true
          },
          "corsPolicy": {
            "type": "string",
            "nullable": true
          },
          "maxRequestBodySize": {
            "type": "integer",
            "format": "int64",
            "nullable": true
          },
          "metadata": {
            "type": "object",
            "additionalProperties": {
              "type": "string"
            },
            "nullable": true
          },
          "transforms": {
            "type": "array",
            "items": {
              "type": "object",
              "additionalProperties": {
                "type": "string"
              }
            },
            "nullable": true
          }
        },
        "additionalProperties": false
      },
      "RouteHeader": {
        "type": "object",
        "properties": {
          "name": {
            "type": "string",
            "nullable": true
          },
          "values": {
            "type": "array",
            "items": {
              "type": "string"
            },
            "nullable": true
          },
          "mode": {
            "$ref": "#/components/schemas/HeaderMatchMode"
          },
          "isCaseSensitive": {
            "type": "boolean"
          }
        },
        "additionalProperties": false
      },
      "RouteMatch": {
        "type": "object",
        "properties": {
          "methods": {
            "type": "array",
            "items": {
              "type": "string"
            },
            "nullable": true
          },
          "hosts": {
            "type": "array",
            "items": {
              "type": "string"
            },
            "nullable": true
          },
          "path": {
            "type": "string",
            "nullable": true
          },
          "queryParameters": {
            "type": "array",
            "items": {
              "$ref": "#/components/schemas/RouteQueryParameter"
            },
            "nullable": true
          },
          "headers": {
            "type": "array",
            "items": {
              "$ref": "#/components/schemas/RouteHeader"
            },
            "nullable": true
          }
        },
        "additionalProperties": false
      },
      "RouteQueryParameter": {
        "type": "object",
        "properties": {
          "name": {
            "type": "string",
            "nullable": true
          },
          "values": {
            "type": "array",
            "items": {
              "type": "string"
            },
            "nullable": true
          },
          "mode": {
            "$ref": "#/components/schemas/QueryParameterMatchMode"
          },
          "isCaseSensitive": {
            "type": "boolean"
          }
        },
        "additionalProperties": false
      },
      "SameSiteMode": {
        "enum": [
          0,
          1,
          2,
          -1
        ],
        "type": "integer",
        "format": "int32"
      },
      "SessionAffinityConfig": {
        "type": "object",
        "properties": {
          "enabled": {
            "type": "boolean",
            "nullable": true
          },
          "policy": {
            "type": "string",
            "nullable": true
          },
          "failurePolicy": {
            "type": "string",
            "nullable": true
          },
          "affinityKeyName": {
            "type": "string",
            "nullable": true
          },
          "cookie": {
            "$ref": "#/components/schemas/SessionAffinityCookieConfig"
          }
        },
        "additionalProperties": false
      },
      "SessionAffinityCookieConfig": {
        "type": "object",
        "properties": {
          "path": {
            "type": "string",
            "nullable": true
          },
          "domain": {
            "type": "string",
            "nullable": true
          },
          "httpOnly": {
            "type": "boolean",
            "nullable": true
          },
          "securePolicy": {
            "$ref": "#/components/schemas/CookieSecurePolicy"
          },
          "sameSite": {
            "$ref": "#/components/schemas/SameSiteMode"
          },
          "expiration": {
            "type": "string",
            "format": "date-span",
            "nullable": true
          },
          "maxAge": {
            "type": "string",
            "format": "date-span",
            "nullable": true
          },
          "isEssential": {
            "type": "boolean",
            "nullable": true
          }
        },
        "additionalProperties": false
      },
      "SslProtocols": {
        "enum": [
          0,
          12,
          48,
          192,
          240,
          768,
          3072,
          12288
        ],
        "type": "integer",
        "format": "int32"
      },
      "UpdateClusterCommand": {
        "type": "object",
        "properties": {
          "clusterId": {
            "type": "string",
            "nullable": true
          },
          "clusterConfig": {
            "$ref": "#/components/schemas/ClusterConfig"
          }
        },
        "additionalProperties": false
      },
      "UpdateRouteCommand": {
        "type": "object",
        "properties": {
          "routeId": {
            "type": "string",
            "nullable": true
          },
          "routeConfig": {
            "$ref": "#/components/schemas/RouteConfig"
          }
        },
        "additionalProperties": false
      },
      "WebProxyConfig": {
        "type": "object",
        "properties": {
          "address": {
            "type": "string",
            "format": "uri",
            "nullable": true
          },
          "bypassOnLocal": {
            "type": "boolean",
            "nullable": true
          },
          "useDefaultCredentials": {
            "type": "boolean",
            "nullable": true
          }
        },
        "additionalProperties": false
      }
    }
  }
}